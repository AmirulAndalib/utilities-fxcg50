//#include "common.cpp"

void setDate() {
  int key, inscreen = 1;
  unsigned int selyear = ((*RYRCNT >> 12) & 0b1111)*1000 + ((*RYRCNT >> 8) & 0b1111)*100 + ((*RYRCNT >> 4) & 0b1111)*10 + (*RYRCNT & 0b1111);
  unsigned int selmonth = ((*RMONCNT & 0b10000)>>4)*10 + (*RMONCNT & 0b1111) -1; //ZERO based!
  char buffer1[50] = "";
  char buffer2[50] = "";
  // YEAR SELECTION SCREEN:
  Bdisp_AllClr_VRAM();
  DisplayStatusArea();
  PrintXY(1, 1, (char*)"  Set date", TEXT_MODE_NORMAL, TEXT_COLOR_BLUE);
  PrintXY(3, 2, (char*)"  Year", TEXT_MODE_NORMAL, TEXT_COLOR_BLACK);
  PrintXY(5, 4, (char*)"  \xe6\x92", TEXT_MODE_NORMAL, TEXT_COLOR_PURPLE); //arrow up
  PrintXY(5, 6, (char*)"  \xe6\x93", TEXT_MODE_NORMAL, TEXT_COLOR_PURPLE); //arrow down
  while(inscreen)
  {
    PrintXY(5, 5, (char*)"                       ", TEXT_MODE_NORMAL, TEXT_COLOR_BLACK); //clear line
    strcpy(buffer1, "  ");
    itoa(selyear, (unsigned char*)buffer2);
    strcat(buffer1, buffer2);
    PrintXY(5, 5, buffer1, TEXT_MODE_NORMAL, TEXT_COLOR_BLACK); //year
    GetKey(&key);
    switch(key)
    {
      case KEY_CTRL_DOWN:
        if (selyear != 0) {
          selyear--;
        }
        break;
      case KEY_CTRL_UP:
        if (selyear != 9999) {
          selyear++;
        }
        break;
      case KEY_CTRL_EXE:
        inscreen = 0;
        break;
      case KEY_CTRL_EXIT: return;
    }
  }

  // MONTH SELECTION SCREEN:
  inscreen = 1;
  Bdisp_AllClr_VRAM();
  DisplayStatusArea();
  PrintXY(1, 1, (char*)"  Set date", TEXT_MODE_NORMAL, TEXT_COLOR_BLUE);
  PrintXY(3, 2, (char*)"  Month", TEXT_MODE_NORMAL, TEXT_COLOR_BLACK);
  PrintXY(5, 4, (char*)"  \xe6\x92", TEXT_MODE_NORMAL, TEXT_COLOR_PURPLE); //arrow up
  PrintXY(5, 6, (char*)"  \xe6\x93", TEXT_MODE_NORMAL, TEXT_COLOR_PURPLE); //arrow down
  while(inscreen)
  {
    PrintXY(5, 5, (char*)"                       ", TEXT_MODE_NORMAL, TEXT_COLOR_BLACK); //clear line
    strcpy(buffer1, "  ");
    strcat(buffer1, monthNames[selmonth]);
    PrintXY(5, 5, buffer1, TEXT_MODE_NORMAL, TEXT_COLOR_BLACK); //month name
    GetKey(&key);
    switch(key)
    {
      case KEY_CTRL_DOWN:
        if (selmonth == 0) { //it is zero-based...
          selmonth = 11;
        } else {
          selmonth--;
        }
        break;
      case KEY_CTRL_UP:
        if (selmonth == 11) { //it is zero-based...
          selmonth = 0;
        } else {
          selmonth++;
        }
        break;
      case KEY_CTRL_EXE:
        
        
        break;
      case KEY_CTRL_EXIT: return;
    }
  }
  
  // DAY SELECTION SCREEN:
  inscreen = 1;
  Bdisp_AllClr_VRAM();
  DisplayStatusArea();
  PrintXY(1, 1, (char*)"  Set date", TEXT_MODE_NORMAL, TEXT_COLOR_BLUE);
  PrintXY(3, 2, (char*)"  Month", TEXT_MODE_NORMAL, TEXT_COLOR_BLACK);
  PrintXY(5, 4, (char*)"  \xe6\x92", TEXT_MODE_NORMAL, TEXT_COLOR_PURPLE); //arrow up
  PrintXY(5, 6, (char*)"  \xe6\x93", TEXT_MODE_NORMAL, TEXT_COLOR_PURPLE); //arrow down
  while(inscreen)
  {
    PrintXY(5, 5, (char*)"                       ", TEXT_MODE_NORMAL, TEXT_COLOR_BLACK); //clear line
    strcpy(buffer1, "  ");
    strcat(buffer1, monthNames[selmonth]);
    PrintXY(5, 5, buffer1, TEXT_MODE_NORMAL, TEXT_COLOR_BLACK); //month name
    GetKey(&key);
    switch(key)
    {
      case KEY_CTRL_DOWN:
        if (selmonth == 0) { //it is zero-based...
          selmonth = 11;
        } else {
          selmonth--;
        }
        break;
      case KEY_CTRL_UP:
        if (selmonth == 11) { //it is zero-based...
          selmonth = 0;
        } else {
          selmonth++;
        }
        break;
      case KEY_CTRL_EXE:
        
        
        break;
      case KEY_CTRL_EXIT: return;
    }
  }
}
